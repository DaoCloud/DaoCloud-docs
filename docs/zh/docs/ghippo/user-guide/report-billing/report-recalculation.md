# 历史数据重算

GPU 指标计算公式变更后，可以对历史数据执行重新计算，使旧报表和成本数据应用新的计算逻辑。

重算范围涵盖：

- 资源告警数据
- 资源审计数据
- 成本分摊数据

## 操作指南

!!! warning

    当前版本未提供控制台入口。如需重算，请联系管理员通过 API 触发。

### 1. 触发重算任务

管理员通过 API 提交请求，需指定重算的 __开始日期__ 和 __结束日期__ 。

**请求示例：**

```bash
curl -X POST \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <token>" \
  -d '{"start_date": "2025-01-01", "end_date": "2025-01-15"}' \
  "http://<api-address>/apis/gmagpie.io/v1alpha1/report/recalculate"
```

![API 调用示例](../images/report-recalc-api.png)

### 2. 任务处理逻辑

系统接收请求后会在后台按序处理：

- **排队执行**：请求进入队列，遵循先入先出原则。
- **逐日重算**：按日期顺序依次重算，确保数据准确。
- **状态同步**：完成后后台自动更新任务状态。

### 3. 注意事项

- **耗时**：重算属于计算密集型任务。一个月的数据通常需要数十分钟，具体取决于集群规模。
- **性能影响**：建议在业务低峰期执行。
- **数据覆盖**：操作会覆盖原有报表数据，请务必确认公式准确。

## 常见问题

**Q: 重算期间报表是否可用？**

可以查看，但在任务结束前，报表显示的可能是旧数据或更新中的中间状态。

**Q: 是否支持并行重算？**

不支持。为保证数据一致性（如成本分摊对前序状态的依赖），系统采用串行方式按日处理。

**Q: 重算的数据范围？**

实际支持的时间范围会以可观测采集的的数据保留时长为准，再次重算的逻辑是从可观测的指标数据中再次计算。
