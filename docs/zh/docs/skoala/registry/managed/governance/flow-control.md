---
hide:
  -toc
---

# 创建流控规则

流控规则的原理是监控应用或服务流量的 QPS 指标，当指标达到阈值时根据预先设定的规则对请求流量进行控制，防止应用因短时间内无法处理过多流量而崩溃。使用流控规则后，系统可以在接下来的空闲期间逐渐处理堆积的请求，当指标重新恢复到阈值以下后，恢复正常的流量请求控制。

创建流控规则的方式如下：

1. 点击目标托管注册中心的名称，然后在左侧导航栏点击`微服务列表`，在最右侧点击更多按钮选择`治理`。

    > 注意需要治理的微服务在`是否可以治理`一栏应该显示为`是`，才能进行后续步骤。

    ![微服务列表](https://docs.daocloud.io/daocloud-docs-images/docs/skoala/registry/managed/imgs/gov00.png)

2. 选择`流控规则`，然后在右侧点击`创建流控规则`。

    ![微服务列表](https://docs.daocloud.io/daocloud-docs-images/docs/skoala/registry/managed/imgs/gov01.png)

3. 参考下列说明填写规则配置，并在右下角点击`确定`。

    ![微服务列表](https://docs.daocloud.io/daocloud-docs-images/docs/skoala/registry/managed/imgs/gov02.png)

    - 资源名：资源的名称，资源是指规则的作用领域，即创建此规则是为了治理哪个服务的流量。<!--必须填写真实存在的资源的名称。-->

    - 来源应用：Sentinel 可以针对调用者进行限流，默认为 default，表示不区分来源，适用于所有的调用者。

    - 直接模式：当前的资源达到阈值时，直接限流。

    - 关联模式：当关联的资源达到阈值时，限流关联资源。

    - 链路模式：只记录指定链路上的流量（指定资源从入口资源进来的流量，如果达到阈值，就可以限流）。

4. 创建完成后可以在流控规则列表中查看新建的规则。在右侧点击更多按钮可以编辑更新规则或者删除该规则。

    ![流控规则列表](https://docs.daocloud.io/daocloud-docs-images/docs/skoala/registry/managed/imgs/gov03.png)

<!--
    - 阈值类型：

        - QPS：QPS 指每秒钟的请求数量，当调用该接口的 QPS 达到阈值时进行限流。
        - 线程数：调用该接口的线程数达到阈值时进行限流。

    - 阈值模式：

        - 单机阈值：仅针对某个节点设置阈值。
        - 是否集群：是否针对整个集群设置阈值。

    - 流控效果：

        - 快速失败：流量超过设定的阈值时，直接拒绝请求。

        - Warm Up：缓慢增加通过的流量，逐渐预热系统，防止空闲系统突然涌入大量流量而被压垮。从请求 QPS 从 阈值 / 3 开始，设置预热时长，经预热时长后逐渐升至设定的 QPS 阈值。

        - 排队等待：流量超过阈值时排队匀速通过，阈值类型必须需设成 QPS，否则无效。适用于处理间隔性突发流量，在某一秒有大量请求涌入，而接下来的几秒则处于空闲状态，例如消息队列。
-->
