# 集群部署模式使用场景

DCE 5.0 提供了[四种集群角色](../../kpanda/user-guide/clusters/cluster-role.md)，用以满足不同的使用场景。
用户可以基于自身业务特性和基础设施场景，自由组合不同的集群部署组合。

本文将对几种常用使用场景进行说明。

## 单数据中心场景

当用户大部分业务集中在某一个区域的单数据中心时，无跨网需求，且对数据容灾要求较低的场景下。
推荐使用简约模式。即只需一个集群用于运行平台相关组件（全局服务集群 + 管理集群二合一），
另外部署多个集群用于运行业务负载（工作集群）。单个集群节点数量由具体业务场景决定，
推荐每个集群使用 3 个 master 节点，以实现使用高可用。

具体部署方案依据业务需要，参考如下部署流程：

## 单数据中心单管理集群

![模式示意图](https://docs.daocloud.io/daocloud-docs-images/docs/install/images/scenario01.png)

前提：准备一台节点，节点的操作系统和架构需与待创建集群的节点保持一致。

1. 在火种节点部署安装器，使用安装器安装一个包含全局服务集群和管理集群两个集群角色的集群。

1. 按需在平台下的容器管理模块上基于管理集群创建一个或多个工作集群。

## 单数据中心多管理集群

当用户需要在当前单数据中心内新增一个管理集群用于管理新业务集群的生命周期，
此时无需再次使用火种节点的方式进行安装，只需要在已经创建的某个工作集群上安装
kubean Operator 组件即可赋予这个集群管理集群的能力和角色。如下图：

![模式示意图](https://docs.daocloud.io/daocloud-docs-images/docs/install/images/scenario02.png)

前提：已经完成上一步单数据中心单管理集群的部署。

1. 在某个工作集群详情界面使用 [helm 模板](../../kpanda/user-guide/helm/README.md)安装 kubean，等待 kubean 状态变为运行中。

1. 当前工作集群安装完成 kubean 后，集群角色将自动变为管理集群，
   按需在平台下的容器管理模块上基于管理集群创建一个或多个工作集群。

## 多数据中心场景

当用户存在多个数据中心，或不同数据中心网络存在隔离，例如在两地三中心等容灾场景下，
用户在不同区域、不同数据中心有集群生命周期管理需求。推荐使用经典模式。
此时可以在不同的数据中心或区域各部署一个管理集群，并将所有的管理集群接入进全局服务集群进行纳管，
从而实现统一管理不同区域内集群的生命周期。

### 多数据中心多管理集群

前提：准备一台节点，节点的操作系统和架构需与待创建集群的节点保持一致。

![模式示意图](https://docs.daocloud.io/daocloud-docs-images/docs/install/images/scenario03.png)

#### 上海数据中心

1. 在火种节点部署安装器，使用安装器安装一个管理集群。

1. 管理集群安装完成后将基于[集群配置文件](./cluster-config.md)自动创建一个全局服务集群。

1. 按需在平台下的容器管理模块上基于管理集群创建一个或多个工作集群。

在跨区域和网络隔离场景下，需要统一纳管其它数据中心的集群生命生命周期，请参考如下配置流程。

#### 北京数据中心

前提：在北京数据中心准备一台节点，节点的操作系统和架构需与待创建集群的节点保持一致。

1. 在火种节点部署安装器，使用安装器安装一个管理集群。

1. 在平台下的容器管理模块（运行在上海数据中心）接入北京数据中心新安装的管理集群。

1. 按需在平台（运行在上海数据中心）下的容器管理模块上基于北京数据中心于管理集群创建一个或多个工作集群。
