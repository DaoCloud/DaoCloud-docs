---
hide:
  - toc
---

# 多云定时任务

参照以下步骤创建一个定时任务（Cronob）。

1. 在左侧导航栏中，点击 __多云工作负载__ ，进入定时任务页面，点击右上角的 __镜像创建__ 按钮。

    ![镜像创建](https://docs.daocloud.io/daocloud-docs-images/docs/kairship/images/cronjob01.png)

1. 在 __创建任务__ 页面中，配置负载的基本信息后，点击 __下一步__ 。

    ![基本信息](https://docs.daocloud.io/daocloud-docs-images/docs/kairship/images/cronjob02.png)

    - 负载名称：最多包含 63 个字符，只能包含小写字母、数字及分隔符（“-”），且必须以小写字母或数字开头及结尾。同一命名空间内同一类型工作负载的名称不得重复，而且负载名称在工作负载创建好之后不可更改。
    - 多云命名空间：选择将新建的任务部署在哪个命名空间，默认使用 default 命名空间。找不到所需的命名空间时可以根据页面提示去创建新的。
    - 部署集群：提供三种选择的方式，决定工作负载将会部署在哪些集群上。
    - 实例数：输入工作负载的 Pod 实例数量。默认创建 1 个 Pod 实例。
    - 调度策略：提供三种选择方式，决定将工作负载的实例以哪种方式进行分配。
    - 描述：输入工作负载的描述信息，内容自定义。字符数量应不超过 512 个。

    部署集群分为三种方式：

    - 指定集群：通过选择集群名称来指定集群
    - 指定地域：通过选择厂商、地域、可用区来指定集群
    - 指定标签：通过添加指标来指定集群
    - 还可以在高级部署策略中选择排除集群/设置集群污点容忍度/动态区域选择，最终会在底部展示预计会被调度到哪些集群上。

    调度策略分为三种方式

    - 重复：在所选的所有集群内分别调度相同的实例数
    - 聚合：将实例总数尽可能少的调度在所选择的所有集群中
    - 动态权重：根据所选择的所有集群实时的可调度最大实例数，等比例运行所填实例总数

1. 在 __容器配置__ 页面中，配置负载所在容器的基本信息，可选择配置生命周期、健康检查等信息，然后点击 __下一步__ 。

    ![容器配置](https://docs.daocloud.io/daocloud-docs-images/docs/kairship/images/cronjob03.png)

1. 在 __定时任务配置__ 页面，配置并发策略、定时规则、任务记录、其他配置等信息

    ![定时任务配置](https://docs.daocloud.io/daocloud-docs-images/docs/kairship/images/cronjob04.png)

    - 并发策略：是否允许多个 Job 任务并行执行。

        - __Allow__ ：可以在前一个任务未完成时就创建新的定时任务，而且多个任务可以并行。任务太多可能抢占集群资源。
        - __Forbid__ ：在前一个任务完成之前，不能创建新任务，如果新任务的执行时间到了而之前的任务仍未执行完，CronJob 会忽略新任务的执行。
        - __Replace__ ：如果新任务的执行时间到了，但前一个任务还未完成，新的任务会取代前一个任务。

        > 上述规则仅适用于同一个 CronJob 创建的多个任务。多个 CronJob 创建的多个任务总是允许并发执行。

    - 定时规则：基于分钟、小时、天、周、月设置任务执行的时间周期。支持用数字和 `*` 自定义 Cron 表达式，**输入表达式后下方会提示当前表达式的含义**。有关详细的表达式语法规则，可参考 [Cron 时间表语法](https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/cron-jobs/#cron-schedule-syntax)。
    - 任务记录：设定保留多少条任务执行成功或失败的记录。 __0__ 表示不保留。
    - 超时时间：超出该时间时，任务就会被标识为执行失败，任务下的所有 Pod 都会被删除。为空时表示不设置超时时间。默认值为 360 s。
    - 重试次数：任务可重试次数，默认值为 6。
    - 重启策略：设置任务失败时是否重启 Pod。

1. 在 __高级配置__ 页面中，可以配置任务设置和标签与注解。

    ![高级配置](https://docs.daocloud.io/daocloud-docs-images/docs/kairship/images/cronjob05.png)

    如果您在创建完成后，无需配置差异化时，则可以直接使用 __确认__ 完成多云任务的创建。

1. 在 __差异化配置__ 页面中，选择个性化的容器配置、标签和注解后，点击 __确定__ 。

    ![差异化配置](https://docs.daocloud.io/daocloud-docs-images/docs/kairship/images/cronjob06.png)

    您可以在左侧列表区域增加对应的差异化配置项，当您新增一个差异化配置项之后，需要指定对应的集群。
    集群的可选择范围仅为刚开始选择的集群，被选择的集群则会使用指定的差异化配置；未被指定的集群仍旧使用默认配置。

!!! note

    - 通过镜像创建多云工作负载时，如果需要采用指定位置、指定标签的高级能力进行创建时，需要确保工作集群已设定对应的位置或者标签；
    增加标签需要在单个集群内增加，可由工作集群管理列表跳转到对应的集群维护。
    - 配置副本数时，需要关注对应的调度策略，仅重复时会在多个集群中全部启动配置的副本数。
