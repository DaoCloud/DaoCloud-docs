# 创建工作集群

在 DCE 5.0 容器管理模块中，[集群角色](./ClusterRole.md#集群角色)分四类：全局服务集群、管理集群、工作集群、接入集群。其中，接入集群只能从第三方厂商接入，参见[接入集群](JoinACluster.md)。

本页介绍如何创建工作集群。

## 前提条件

创建集群之前需要满足一定的前提条件：

- 使用 1.21 或更高版本的 Kubernetes。
- 目标主机需要允许 IPv4 转发。如果 Pod 和 Service 使用的是 IPv6，则目标服务器需要允许 IPv6 转发。
- 我们不提供对防火墙的管理功能，您需要预先自行定义目标主机防火墙规则。为了避免创建集群的过程中出现问题，建议禁用目标主机的防火墙。
- 如果在非 root 用户账户下运行，请预先在目标主机中为用户提升权限，并确保所有目标主机上的用户名和密码都相同。

## 操作步骤

1. 在`集群列表`页面中，点击`创建集群`按钮。

    ![创建集群按钮](../../images/createcluster.png)

2. 填写集群基本信息，并点击`下一步`

    ![填写基本信息](../../images/createcluster01.png)

3. 填写节点配置信息，并点击`下一步`

    - 如果使用 SSH 密钥方式连接待创建集群的所有节点，您需要预先配置节点 SSH 密钥。参阅[使用 SSH 密钥认证节点](../Nodes/NodeConfig.md)。
    - 如果开启高可用，则默认控制器节点为 3；
    - 如果关闭高可用，则默认控制器节点为 1；
    - 在生产环境中建议使用高可用模式。

        ![填写基本信息](../../images/createcluster02.png)

4. 填写网络配置信息，并点击`下一步`

    ![填写网络配置信息](../../images/createcluster03.png)

5. 填写插件配置信息，并点击`下一步`

    ![填写插件配置信息](../../images/createcluster04.png)

6. 填写高级配置信息，并点击`确定`

    - `kubelet_max_pods`：设置每个节点的最大 Pod 数量，默认为 110 个。
    - `hostname_overide`：重置主机名，建议使用默认值，采用系统默认生成的名称作为主机名称。
    - `kubernetes_audit`：Kubernetes 的审计日志，默认开启。
    - `auto_renew_certificate`：在每月第一个星期一自动更新 Kubernetes 控制平面证书，默认开启。
    - `disable_firewalld&ufw`：禁用防火墙，避免节点在安装过程中无法被访问。
    - `Insecure_registries`：私有镜像仓库配置。使用私有镜像仓库创建集群时，为了避免证书问题导致容器引擎拒绝访问，需要在这里填写私有镜像仓库地址，以绕过容器引擎的证书认证而获取镜像。

        ![填写高级配置信息](../../images/createcluster05.png)

## 完成创建

填写正确信息并完成上述步骤后，页面会提示集群正在创建中。

!!! note

    创建集群耗时较长，需要耐心等待。其间，可以点击`返回集群列表`按钮回到集群列表页面，等待集群创建完成。如需查看当前状态，可点击`实时日志`。

![创建成功](../../images/createcluster06.png)

![查看实时日志](../../images/createcluster07.png)