---
date: 2023-08-18
status: new
---

# ç›‘æ§çœ‹æ¿æŒ‡æ ‡è¯´æ˜

æœ¬æ–‡ç”¨äºè¡¥å……ä»‹ç»ï¼Œç½‘æ ¼å®ä¾‹ä¸­æµé‡ç›‘æ§ä¸­çš„å„ä¸ªç›‘æ§çœ‹æ¿çš„æŒ‡æ ‡çš„å«ä¹‰ï¼Œæ–¹ä¾¿ç”¨æˆ·æŸ¥è¯¢å’Œå®šä¹‰

## å…¨å±€ç›‘æ§

![å…¨å±€ç›‘æ§](../images/monitoring-indicators1.png)

| åˆ†ç±»                  | å‚æ•°                      | å‚æ•°ä»‹ç»                                                     | è®¡ç®—æ–¹å¼                                                     |
| --------------------- | ------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| å¸¸è§„                  | å…¨å±€è¯·æ±‚æ€»é‡              | "Global Request Volume" ä»£è¡¨æ•´ä¸ªæœåŠ¡ç½‘æ ¼ä¸­çš„è¯·æ±‚æµé‡æ€»é‡ï¼ŒOps/s æ ‡è¯†æ¯ç§’æ‰§è¡Œçš„æ“ä½œæˆ–è¯·æ±‚çš„æ•°é‡ã€‚åœ¨ Istioä¸­ï¼Œè¿™ä¸ªåº¦é‡é€šå¸¸ç”¨æ¥è¯„ä¼°æ•´ä¸ªæœåŠ¡ç½‘æ ¼çš„æµé‡ | OPS/s = æ€»æ“ä½œæ•° / æ—¶é—´æ®µï¼ˆç§’ï¼‰                              |
|                       | å…¨å±€æˆåŠŸç‡ï¼ˆé 5xx å“åº”ï¼‰ |                                                              | å…¨å±€æˆåŠŸç‡ï¼ˆéå“åº”ç‡ 5xxï¼‰ = (æ€»è¯·æ±‚ - 5xx å“åº”) / æ€»è¯·æ±‚ * 100 |
|                       | 4xxs                      | 4xxs æ˜¯å®¢æˆ·ç«¯é”™è¯¯ï¼Œè¡¨ç¤ºè¯·æ±‚å¯èƒ½æœ‰é—®é¢˜ï¼ˆä¾‹å¦‚ï¼Œ404 è¡¨ç¤ºæœªæ‰¾åˆ°ï¼‰ | ops/s = æ¯ç§’æ”¶åˆ°çš„ 4xx å“åº”çš„æ•°é‡                            |
|                       | 5xxs                      | 5xxs æ˜¯æœåŠ¡å™¨é”™è¯¯ï¼Œè¡¨ç¤ºæœåŠ¡å™¨æœªèƒ½æ­£ç¡®å¤„ç†æœ‰æ•ˆè¯·æ±‚ï¼ˆä¾‹å¦‚ï¼Œ500 è¡¨ç¤ºå†…éƒ¨æœåŠ¡å™¨é”™è¯¯ï¼‰ | ops/s = æ¯ç§’æ”¶åˆ°çš„ 5xx å“åº”çš„æ•°é‡                            |
|                       | è™šæ‹ŸæœåŠ¡                  | ç»Ÿè®¡ä¸€æ®µæ—¶é—´èŒƒå›´å†…æœåŠ¡ç½‘æ ¼å†…çš„è™šæ‹ŸæœåŠ¡çš„å‡€å¢é•¿æƒ…å†µï¼Œé€šè¿‡æ¯”è¾ƒæ·»åŠ å’Œåˆ é™¤äº‹ä»¶çš„æ•°é‡ï¼Œå¯ä»¥äº†è§£æœåŠ¡çš„åŠ¨æ€å˜åŒ–ï¼Œå¹¶å¯èƒ½æœ‰åŠ©äºè¯†åˆ«æ½œåœ¨çš„é—®é¢˜ã€‚ | max(Virtual Services && and) - max(Virtual Services && delete) |
|                       | ç›®æ ‡è§„åˆ™                  | ç»Ÿè®¡ä¸€æ®µæ—¶é—´èŒƒå›´å†…æœåŠ¡ç½‘æ ¼å†…çš„ç›®æ ‡è§„åˆ™ï¼ˆDestination Ruleï¼‰çš„å‡€å¢é•¿æƒ…å†µï¼Œé€šè¿‡æ¯”è¾ƒæ·»åŠ å’Œåˆ é™¤äº‹ä»¶çš„æ•°é‡ï¼Œå¯ä»¥äº†è§£æœåŠ¡çš„åŠ¨æ€å˜åŒ–ï¼Œå¹¶å¯èƒ½æœ‰åŠ©äºè¯†åˆ«æ½œåœ¨çš„é—®é¢˜ã€‚ | max(Destination Rule && and) - max(Destination Rule && delete) |
|                       | ç½‘å…³è§„åˆ™                  | ç»Ÿè®¡ä¸€æ®µæ—¶é—´èŒƒå›´å†…æœåŠ¡ç½‘æ ¼å†…çš„ç½‘å…³è§„åˆ™ï¼ˆGatewayï¼‰çš„å‡€å¢é•¿æƒ…å†µï¼Œé€šè¿‡æ¯”è¾ƒæ·»åŠ å’Œåˆ é™¤äº‹ä»¶çš„æ•°é‡ï¼Œå¯ä»¥äº†è§£æœåŠ¡çš„åŠ¨æ€å˜åŒ–ï¼Œå¹¶å¯èƒ½æœ‰åŠ©äºè¯†åˆ«æ½œåœ¨çš„é—®é¢˜ã€‚ | max(Gateway && and) - max(Gateway && delete)                 |
|                       | å·¥ä½œè´Ÿè½½æ¡ç›®              | ç»Ÿè®¡ä¸€æ®µæ—¶é—´å†… WorkloadEntry çš„å¢é•¿è¶‹åŠ¿ï¼Œé€šè¿‡è§‚å¯Ÿ Workload çš„å˜åŒ–ï¼Œå¯ä»¥å¿«é€Ÿäº†è§£æœåŠ¡çš„åŠ¨æ€å˜åŒ–ï¼Œå¹¶å¯èƒ½æœ‰åŠ©äºè¯†åˆ«æ½œåœ¨çš„é—®é¢˜ã€‚ | max(WorkloadEntry && and) - max(WorkloadEntry && delete)     |
|                       | æœåŠ¡æ¡ç›®                  | ç»Ÿè®¡ä¸€æ®µæ—¶é—´å†… Service Entries çš„å¢é•¿è¶‹åŠ¿ï¼Œé€šè¿‡è§‚å¯Ÿ Service Entries çš„å˜åŒ–ï¼Œå¯ä»¥å¿«é€Ÿäº†è§£æœåŠ¡çš„åŠ¨æ€å˜åŒ–ï¼Œå¹¶å¯èƒ½æœ‰åŠ©äºè¯†åˆ«æ½œåœ¨çš„é—®é¢˜ã€‚ | max(Service Entries && and) - max(Service Entries && delete) |
|                       | å¯¹ç­‰è®¤è¯ç­–ç•¥              | ç»Ÿè®¡ä¸€æ®µæ—¶é—´å†… PeerAuthentication Policies çš„å¢é•¿è¶‹åŠ¿ï¼Œé€šè¿‡è§‚å¯Ÿ PeerAuthentication Policies çš„å˜åŒ–ï¼Œå¯ä»¥å¿«é€Ÿäº†è§£æœåŠ¡çš„åŠ¨æ€å˜åŒ–ï¼Œå¹¶å¯èƒ½æœ‰åŠ©äºè¯†åˆ«æ½œåœ¨çš„é—®é¢˜ã€‚ | max(PeerAuthentication Policies && and) - max(PeerAuthentication Policies && delete) |
|                       | è¯·æ±‚è®¤è¯ç­–ç•¥              | ç»Ÿè®¡ä¸€æ®µæ—¶é—´å†… RequestAuthentication Policies çš„å¢é•¿è¶‹åŠ¿ï¼Œé€šè¿‡è§‚å¯Ÿ RequestAuthentication Policies çš„å˜åŒ–ï¼Œå¯ä»¥å¿«é€Ÿäº†è§£æœåŠ¡çš„åŠ¨æ€å˜åŒ–ï¼Œå¹¶å¯èƒ½æœ‰åŠ©äºè¯†åˆ«æ½œåœ¨çš„é—®é¢˜ã€‚ | max(RequestAuthentication Policies && and) - max(RequestAuthentication Policies && delete) |
|                       | æˆæƒç­–ç•¥                  | ç»Ÿè®¡ä¸€æ®µæ—¶é—´å†… Authorization Policies çš„å¢é•¿è¶‹åŠ¿ï¼Œé€šè¿‡è§‚å¯Ÿ Authorization Policies çš„å˜åŒ–ï¼Œå¯ä»¥å¿«é€Ÿäº†è§£æœåŠ¡çš„åŠ¨æ€å˜åŒ–ï¼Œå¹¶å¯èƒ½æœ‰åŠ©äºè¯†åˆ«æ½œåœ¨çš„é—®é¢˜ã€‚ | max(Authorization Policies  && and) - max(Authorization Policies  && delete) |
| HTTP/GRPC å·¥ä½œè´Ÿè½½    | Service                   | æœåŠ¡åç§°ï¼Œåç§°ç»„åˆæœåŠ¡æ‰€åœ¨çš„å‘½åç©ºé—´å’Œ Kubernetes çš„ Service è®¿é—®ä¿¡æ¯ |                                                              |
|                       | å·¥ä½œè´Ÿè½½                  | å·¥ä½œè´Ÿè½½åç§°ï¼Œåç§°ç»„åˆå·¥ä½œè´Ÿè½½æ‰€åœ¨çš„å‘½åç©ºé—´                 |                                                              |
|                       | è¯·æ±‚é‡                    | è¯·æ±‚çš„æ•°é‡ï¼Œè¡¨ç¤ºç‰¹å®šæ—¶é—´æ®µå†…çš„è¯·æ±‚æ€»æ•°                       | sum(rate(istio_requests_total{...}[1m]))                     |
|                       | P50 å»¶è¿Ÿ                  | ä¸­ä½æ•°å»¶è¿Ÿï¼Œ50%çš„è¯·æ±‚åœ¨çš„è¯·æ±‚å»¶è¿Ÿåœ¨è¿™ä¸ªæ—¶é—´ä»¥ä¸‹å®Œæˆ          | histogram_quantile(0.50, sum(rate(...))                      |
|                       | P90 å»¶è¿Ÿ                  | 90%çš„è¯·æ±‚åœ¨çš„è¯·æ±‚å»¶è¿Ÿåœ¨è¿™ä¸ªæ—¶é—´ä»¥ä¸‹å®Œæˆ                      | histogram_quantile(0.90, sum(rate(...))                      |
|                       | P99 å»¶è¿Ÿ                  | 99%çš„è¯·æ±‚åœ¨çš„è¯·æ±‚å»¶è¿Ÿåœ¨è¿™ä¸ªæ—¶é—´ä»¥ä¸‹å®Œæˆ                      | histogram_quantile(0.99, sum(rate(...))                      |
|                       | æˆåŠŸç‡                    | æˆåŠŸç‡ï¼Œåœ¨æŸ¥è¯¢æ—¶é—´æ®µå†…æˆåŠŸå“åº”ï¼ˆå“åº”çŠ¶æ€ç ä¸ç­‰äº 5xxï¼‰çš„è¯·æ±‚æ‰€å çš„ç™¾åˆ†æ¯”ï¼Œ | sum(rate(... response_code!~"5.*")) / sum(rate(...))         |
| TCP å·¥ä½œè´Ÿè½½          | Service                   | å·¥ä½œè´Ÿè½½åç§°ï¼Œä» Istio æä¾›çš„æŒ‡æ ‡ä¸­è·å–destination_service æ ‡ç­¾ï¼Œè¿™ä¸ªæ ‡ç­¾åŒ…å«äº†æœåŠ¡çš„åç§°ã€‚ | destination_workload                                         |
|                       | å·¥ä½œè´Ÿè½½                  | å·¥ä½œè´Ÿè½½åç§°ï¼Œä» Istio æä¾›çš„æŒ‡æ ‡ä¸­è·å–destination_workload æ ‡ç­¾ï¼Œè¿™ä¸ªæ ‡ç­¾åŒ…å«äº†å·¥ä½œè´Ÿè½½çš„åç§°ã€‚ | destination_service                                          |
|                       | å‘é€å­—èŠ‚æ•°                | æ¯ç§’å‘é€çš„å­—èŠ‚é‡                                             | é€šè¿‡ istio_tcp_sent_bytes_total è®¡ç®—ç´¯è®¡çš„ TCP å­—èŠ‚ï¼Œä½¿ç”¨ rate è®¡ç®—å¯¹åº”çš„å‘é€é€Ÿç‡ |
|                       | æ¥æ”¶å­—èŠ‚æ•°                | æ¯ç§’æ¥æ”¶çš„å­—èŠ‚é‡                                             | é€šè¿‡ istio_tcp_received_bytes_total è®¡ç®—ç´¯è®¡çš„ TCP å­—èŠ‚ï¼Œä½¿ç”¨ rate è®¡ç®—å¯¹åº”çš„å‘é€é€Ÿç‡ |
| åŸºäºç‰ˆæœ¬çš„ Istio ç»„ä»¶ |                           | Istio ç»„ä»¶æ„å»ºç‰ˆæœ¬çš„å¯è§†åŒ–å±•ç¤ºï¼Œå±•ç¤ºå„ä¸ªç»„ä»¶çš„ç‰ˆæœ¬åˆ†å¸ƒï¼Œä»¥åŠå®ƒä»¬åœ¨ä¸åŒé›†ç¾¤ä¸­çš„éƒ¨ç½²æƒ…å†µã€‚è¿™å¯¹äºäº†è§£ Istio éƒ¨ç½²çš„å¥åº·çŠ¶å†µå’Œä¸€è‡´æ€§éå¸¸æœ‰ç”¨ã€‚ | sum(istio_build{mesh_id="$mesh"}) by (component, tag, mesh_cluster) |

## æ€§èƒ½ç›‘æ§

![æ€§èƒ½ç›‘æ§](../images/monitoring-indicators2.png)

| åˆ†ç±»           | å‚æ•°               | å‚æ•°ä»‹ç»                                                  | è®¡ç®—æ–¹å¼                                                  |
| --------------------- | ------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| VCPU ä½¿ç”¨é‡       | vCPU / 1k rps  | å±•ç¤º Istio æ¯åƒæ¬¡è¯·æ±‚ (1k rps) æ‰€æ¶ˆè€—çš„è™šæ‹Ÿ CPU (vCPU) èµ„æºï¼Œä¸»è¦æŸ¥è¯¢äº† istio-ingressgateway å’Œ istio-proxyã€‚ä¸ºäº†ä¿éšœæŸ¥è¯¢æ•ˆç‡ï¼ŒIstio é™åˆ¶ä»…å½“ istio-ingressgateway è¯·æ±‚å¤§äº 10 æ—¶æ‰è¿›è¡Œ istio-proxy ç»Ÿè®¡ã€‚ | (sum(irate(container_cpu_usage_seconds_total{namespace!="istio-system",container="istio-proxy"}[1m]))/ (round(sum(irate(istio_requests_total[1m])), 0.001)/1000))/ (sum(irate(istio_requests_total{source_workload="istio-ingressgateway"}[1m])) >bool 10) |
|                   | vCPU           | å±•ç¤º Istio ä¸­è™šæ‹Ÿ CPU (vCPU) çš„æ•´ä½“ä½¿ç”¨æƒ…å†µ                  |                                                              |
| å†…å­˜å’Œæ•°æ®        | å†…å­˜ç”¨é‡       | å±•ç¤º Istio ç³»ç»Ÿç»„ä»¶ä¸­çš„å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œç»Ÿè®¡å•ä½ä¸º bytes        | sum(container_memory_working_set_bytes{pod=~"istio-ingressgateway-.*"}) / count(container_memory_working_set_bytes{pod=~"istio-ingressgateway-.*",container!="POD"}) |
|                   | æ•°æ®ä¼ è¾“é‡ B/s | å±•ç¤º Istio ç³»ç»Ÿç»„ä»¶çš„çš„æ¯ç§’ä¼ è¾“çš„å­—èŠ‚æ•°ï¼Œç»Ÿè®¡å•ä½ä¸º Bps      | sum(irate(istio_response_bytes_sum{source_workload="istio-ingressgateway", reporter=~"$reporter",destination_mesh_id="$mesh"}[1m])) |
| Istio ç»„ä»¶ç‰ˆæœ¬    | Istio ç»„ä»¶ç‰ˆæœ¬ | å±•ç¤ºIstioç»„ä»¶çš„ç‰ˆæœ¬ç»Ÿè®¡ä¿¡æ¯ï¼Œå›¾ä¾‹æ ¼å¼å°†åŒ…æ‹¬ç»„ä»¶åç§°ã€æ ‡ç­¾å’Œç½‘æ ¼é›†ç¾¤ã€‚ | sum(istio_build{mesh_id="$mesh"}) by (component, tag, mesh_cluster) |
| è¾¹è½¦èµ„æºä½¿ç”¨ç‡    | å†…å­˜           | å±•ç¤ºè¾¹è½¦å®¹å™¨â€œistio-proxyâ€çš„æ¯åˆ†é’Ÿå·¥ä½œé›†å­—èŠ‚çš„æ€»å’Œçš„å˜åŒ–ï¼Œç”¨äºç›‘è§†Istioä»£ç†å®¹å™¨çš„å†…å­˜ä½¿ç”¨æƒ…å†µ | sum(container_memory_working_set_bytes{container="istio-proxy"}) |
|                   | vCPU           | å±•ç¤ºè¾¹è½¦ä»£ç†ï¼ˆProxyï¼‰èµ„æºä½¿ç”¨çš„è™šæ‹ŸCPUï¼ˆvCPUï¼‰ç»Ÿè®¡ä¿¡æ¯ï¼Œå±•ç¤ºå®¹å™¨â€œistio-proxyâ€çš„CPUä½¿ç”¨ç§’æ•°çš„é€Ÿç‡æ€»å’Œ | sum(rate(container_cpu_usage_seconds_total{container="istio-proxy"}[1m])) |
|                   | ç£ç›˜           | å±•ç¤ºè¾¹è½¦ä»£ç†ï¼ˆProxyï¼‰èµ„æºä½¿ç”¨çš„ç£ç›˜ç»Ÿè®¡ä¿¡æ¯ï¼Œå±•ç¤ºå®¹å™¨â€œistio-proxyâ€çš„æ–‡ä»¶ç³»ç»Ÿä½¿ç”¨å­—èŠ‚çš„æ€»å’Œ | sum(container_fs_usage_bytes{container="istio-proxy"})       |
| Istiod èµ„æºä½¿ç”¨ç‡ | å†…å­˜           | å±•ç¤º Istiod æœåŠ¡çš„å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œæä¾›äº†ä¸€ä¸ªå…¨é¢çš„è§†å›¾ï¼š - æ€»è®¡ï¼šIstiodæœåŠ¡åœ¨Kubernetesä¸­çš„æ€»å†…å­˜ä½¿ç”¨é‡ - å®¹å™¨å†…å­˜ï¼šIstiodæœåŠ¡åœ¨Kubernetesä¸­æ¯ä¸ªå®¹å™¨çš„å†…å­˜ä½¿ç”¨é‡ åŒ…æ‹¬è™šæ‹Ÿå†…å­˜ã€å¸¸é©»å†…å­˜ã€å †å†…å­˜å’Œæ ˆå†…å­˜ç­‰ä¸åŒç±»å‹çš„å†…å­˜ä½¿ç”¨æƒ…å†µã€‚ | æ€»è®¡ï¼ˆTotal (k8s)ï¼‰ï¼š"sum(container_memory_working_set_bytes{container=~\"discovery\|istio-proxy\", pod=~\"istiod-.*\"})" å®¹å™¨å†…å­˜ï¼ˆ{{ container }} (k8s)ï¼‰ï¼š"container_memory_working_set_bytes{container=~\"discovery\|istio-proxy\", pod=~\"istiod-.*\"}" |
|                   | vCPU           | å±•ç¤ºIstiodæœåŠ¡çš„è™šæ‹ŸCPUï¼ˆvCPUï¼‰ä½¿ç”¨æƒ…å†µï¼Œæä¾›äº†ä¸€ä¸ªå…¨é¢çš„è§†å›¾ï¼š - æ€»è®¡ï¼š æ˜¾ç¤ºIstiodæœåŠ¡åœ¨Kubernetesä¸­çš„æ€»CPUä½¿ç”¨ç‡ - å®¹å™¨ CPU ä½¿ç”¨ç‡ï¼šæ˜¾ç¤ºIstiodæœåŠ¡åœ¨Kubernetesä¸­æ¯ä¸ªå®¹å™¨çš„CPUä½¿ç”¨ç‡ - Pilotï¼šæ˜¾ç¤ºIstiodçš„pilotç»„ä»¶çš„CPUä½¿ç”¨æƒ…å†µ | æ€»è®¡ï¼ˆTotal (k8s)ï¼‰: "sum(rate(container_cpu_usage_seconds_total{container=~\"discovery\|istio-proxy\", pod=~\"istiod-.*\"}[1m]))"  å®¹å™¨CPUä½¿ç”¨ç‡ï¼ˆ{{ container }} (k8s)ï¼‰:  "sum(rate(container_cpu_usage_seconds_total{container=~\"discovery\|istio-proxy\", pod=~\"istiod-.*\"}[1m])) by (container)"  pilot: "irate(process_cpu_seconds_total{app=\"istiod\"}[1m])" |
|                   | ç£ç›˜           | å±•ç¤ºæ¯ä¸ªé›†ç¾¤ä¸­ Istioç»„ä»¶çš„ç£ç›˜ä½¿ç”¨æƒ…å†µï¼Œç‰¹åˆ«æ˜¯ä¸discoveryå’Œistio-proxyå®¹å™¨ç›¸å…³çš„æ–‡ä»¶ç³»ç»Ÿä½¿ç”¨æƒ…å†µã€‚ | sum(process_open_fds{mesh_id="$mesh",app="istiod"}) by (mesh_cluster) container_fs_usage_bytes{ container=~"discovery\|istio-proxy", pod=~"istiod-.*"} |
|                   | Goroutines     | å±•ç¤ºæ¯ä¸ªé›†ç¾¤ä¸­ Istioç»„ä»¶çš„Goåç¨‹æ•°é‡çš„è¶‹åŠ¿                   | sum(go_goroutines{mesh_id="$mesh", app="istiod"}) by (mesh_cluster) |

## æœåŠ¡ç›‘æ§

![æœåŠ¡ç›‘æ§](../images/monitoring-indicators3.png)

| åˆ†ç±»           | å‚æ•°               | å‚æ•°ä»‹ç»                                                  | è®¡ç®—æ–¹å¼                                                  |
| --------------------- | ------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| å¸¸è§„           | å®¢æˆ·ç«¯è¯·æ±‚é‡                            | å±•ç¤ºå½“å‰æœåŠ¡çš„å®¢æˆ·ç«¯çš„æ¯ 5 åˆ†é’Ÿçš„è¯·æ±‚æ“ä½œé‡ï¼Œå¦‚æœç»“æœä¸ºç©ºå€¼æ˜¯ä¼šå±•ç¤ºä¸º N/Aï¼›é˜ˆå€¼æ•°å€¼è¶…è¿‡ 80%æ—¶ä¼šå±•ç¤ºä¸ºçº¢è‰² | round(sum(irate(istio_requests_total{reporter=~"$reporter",destination_mesh_id="$mesh",destination_service=~"$service"}[5m])), 0.001) |
|                | å®¢æˆ·ç«¯æˆåŠŸç‡ï¼ˆé 5xx å“åº”ï¼‰             | å±•ç¤ºå½“å‰æœåŠ¡çš„å®¢æˆ·ç«¯çš„æ¯ 5 åˆ†é’Ÿçš„æˆåŠŸè¯·æ±‚ç‡ï¼Œå¹¶ä¸”æä¾›äº†ä¸€ç§å¯è§†åŒ–æ–¹å¼æ¥å¿«é€Ÿè¯†åˆ«æ½œåœ¨çš„é—®é¢˜æˆ–è¶‹åŠ¿ã€‚ | sum(irate(istio_requests_total{reporter=~"$reporter",destination_mesh_id="$mesh",destination_service=~"$service",response_code!~"5.*"}[5m])) / sum(irate(istio_requests_total{reporter=~"$reporter",destination_mesh_id="$mesh",destination_service=~"$service"}[5m])) |
|                | å®¢æˆ·ç«¯è¯·æ±‚æ—¶å»¶                          | å±•ç¤ºå½“å‰æœåŠ¡çš„å®¢æˆ·ç«¯çš„è¯·æ±‚ç”¨æ—¶æƒ…å†µï¼Œå®šä¹‰äº†ä¸‰ä¸ªç›®æ ‡ï¼Œç”¨äºè®¡ç®— P50ã€P90 å’Œ P99 çš„æŒç»­æ—¶é—´ã€‚è¡¨è¾¾å¼åˆ†åˆ«è®¡ç®—äº† 50%ã€90% å’Œ 99% çš„æŒç»­æ—¶é—´ç™¾åˆ†ä½æ•°ã€‚ | ç¤ºä¾‹ï¼š(histogram_quantile(0.50, sum(irate(istio_request_duration_milliseconds_bucket{reporter=~\"$reporter\",destination_mesh_id=\"$mesh\",destination_service=~\"$service\"}[1m])) by (le)) / 1000) or histogram_quantile(0.50, sum(irate(istio_request_duration_seconds_bucket{reporter=~\"$reporter\",destination_mesh_id=\"$mesh\",destination_service=~\"$service\"}[1m])) by (le)) |
|                | TCP æ¥æ”¶å­—èŠ‚æ•°                          | å±•ç¤ºå½“å‰æœåŠ¡åœ¨1 åˆ†é’Ÿå†… TCP æ¥æ”¶å­—èŠ‚çš„å³æ—¶é€Ÿç‡ä¹‹å’Œï¼Œå¦‚æœåŒ¹é…åˆ° "null"ï¼Œç»“æœæ–‡æœ¬ä¸º "N/A"ï¼Œå•ä½ Bps | "sum(irate(istio_tcp_received_bytes_total{reporter=~\"$reporter\",destination_mesh_id=\"$mesh\", destination_service=~\"$service\"}[1m]))" |
|                | æœåŠ¡çš„è¯·æ±‚é‡                            | å±•ç¤ºå½“å‰æœåŠ¡çš„è¯·æ±‚é‡ï¼ŒæŒ‰ç…§æ—¶é—´å±•ç¤ºè¶‹åŠ¿å›¾ï¼Œå¦‚æœåŒ¹é…åˆ° "null"ï¼Œç»“æœæ–‡æœ¬ä¸º "N/A"ï¼Œå•ä½ Ops | round(sum(irate(istio_requests_total{reporter="destination", destination_mesh_id="$mesh",destination_service=~"$service"}[5m])), 0.001) |
|                | æœåŠ¡å™¨æˆåŠŸç‡ï¼ˆé 5xx å“åº”ï¼‰             | å±•ç¤ºå½“å‰æœåŠ¡çš„é 5xx å“åº”çš„æˆåŠŸç‡ï¼Œé˜ˆå€¼è®¾ç½®è¡¨æ˜ï¼Œ95%ä»¥ä¸‹çš„æˆåŠŸç‡æ ‡è®°ä¸ºçº¢è‰²ï¼Œ99%ä»¥ä¸‹çš„æˆåŠŸç‡æ ‡è®°ä¸ºæ©™è‰²ï¼Œ 100%ä¸ºç»¿è‰²ï¼ˆç™¾åˆ†æ¯”å–å€¼ 2ä½ï¼‰ | sum(irate(istio_requests_total{reporter="destination", destination_mesh_id="$mesh",destination_service=~"$service",response_code!~"5.*"}[5m])) / sum(irate(istio_requests_total{reporter="destination", destination_mesh_id="$mesh", destination_mesh_id="$mesh",destination_service=~"$service"}[5m])) |
|                | æœåŠ¡ç«¯è¯·æ±‚æ—¶å»¶                          | å±•ç¤ºå½“å‰æœåŠ¡çš„æœåŠ¡å™¨è¯·æ±‚çš„å»¶æ—¶ï¼Œé€šè¿‡è®¡ç®—ä¸åŒåˆ†ä½æ•°çš„æŒç»­æ—¶é—´æ¥æä¾›å¯¹æœåŠ¡æ€§èƒ½çš„æ·±å…¥äº†è§£ã€‚ä¸‰ä¸ªç›®æ ‡è¡¨è¾¾å¼åˆ†åˆ«è®¡ç®—äº†ä¸­ä½æ•°ã€90%ã€å’Œ99%çš„è¯·æ±‚çš„å»¶æ—¶ï¼Œä»¥æä¾›ä»ä¸­ä½æ•°åˆ°é«˜ç«¯çš„æ€§èƒ½æ¦‚è§ˆ | - histogram_quantile - istio_request_duration_milliseconds_bucket - istio_request_duration_seconds_bucket |
|                | TCP å‘é€å­—èŠ‚æ•°                          | å±•ç¤ºå½“å‰æœåŠ¡åœ¨1 åˆ†é’Ÿå†… TCP å‘é€å­—èŠ‚çš„å³æ—¶é€Ÿç‡ä¹‹å’Œï¼Œå¦‚æœåŒ¹é…åˆ° "null"ï¼Œç»“æœæ–‡æœ¬ä¸º "N/A"ï¼Œå•ä½ Bps |                                                              |
| å®¢æˆ·ç«¯å·¥ä½œè´Ÿè½½ | åŸºäºæºå’Œå“åº”ç çš„ä¼ å…¥è¯·æ±‚                | å±•ç¤ºæŒ‰æºå·¥ä½œè´Ÿè½½å’Œå“åº”ä»£ç åˆ†ç±»çš„ä¼ å…¥è¯·æ±‚ï¼Œèƒ½å¤Ÿå¯è§†åŒ–åœ°å±•ç¤ºå„ç§å·¥ä½œè´Ÿè½½ä¹‹é—´çš„äº¤äº’æƒ…å†µï¼Œåˆ†åˆ«å¯¹å…·æœ‰å’Œä¸å…·æœ‰äº’ç›¸è®¤è¯TLSçš„è¿æ¥è¿›è¡Œè®¡ç®—ï¼Œä»¥æä¾›å¯¹è¿æ¥å®‰å…¨æ€§çš„æ´å¯Ÿã€‚å¯ä»¥æ¸…æ™°åœ°äº†è§£è¯·æ±‚å¦‚ä½•åœ¨ä¸åŒçš„æºå’Œç›®çš„åœ°ä¹‹é—´åˆ†å¸ƒã€‚ |                                                              |
|                | åŸºäºæºçš„ä¼ å…¥æˆåŠŸç‡ï¼ˆé 5xx å“åº”ï¼‰       | å±•ç¤ºæŒ‰æºå·¥ä½œè´Ÿè½½å’Œå‘½åç©ºé—´åˆ†ç±»çš„ä¼ å…¥æˆåŠŸç‡ï¼Œå…¶ä¸­æˆåŠŸç‡æ˜¯é5xxå“åº”çš„ç™¾åˆ†æ¯”ï¼Œåˆ†åˆ«å¯¹å…·æœ‰å’Œä¸å…·æœ‰äº’ç›¸è®¤è¯TLSçš„è¿æ¥è¿›è¡Œè®¡ç®—ï¼Œä»¥æä¾›å¯¹è¿æ¥æˆåŠŸç‡çš„è§†å›¾ã€‚ | sum(irate(istio_requests_total{reporter=~"$reporter",destination_mesh_id="$mesh", connection_security_policy="mutual_tls", destination_service=~"$service",response_code!~"5.*", source_workload=~"$srcwl", source_workload_namespace=~"$srcns"}[5m])) by (source_workload, source_workload_namespace) / sum(irate(istio_requests_total{reporter=~"$reporter",destination_mesh_id="$mesh", connection_security_policy="mutual_tls", destination_service=~"$service", source_workload=~"$srcwl", source_workload_namespace=~"$srcns"}[5m])) by (source_workload, source_workload_namespace) |
|                | åŸºäºæºçš„ä¼ å…¥è¯·æ±‚æ—¶å»¶                    | å±•ç¤ºæŒ‰æºå·¥ä½œè´Ÿè½½å’Œå‘½åç©ºé—´çš„è¯·æ±‚è€—æ—¶ï¼Œåˆ†åˆ«è®¡ç®—äº†P50ã€P90ã€P95 å’Œ P99ç­‰åˆ†ä½æ•°ä¸åŒçš„è¯·æ±‚æŒç»­æ—¶é—´ã€‚æ³¨æ„ï¼Œå°†åˆ†ä½å€¼é™¤ä»¥ 1000 è½¬ä¸ºä¸ºç§’ä½œä¸ºå•ä½ã€‚ | ç¤ºä¾‹ï¼š (histogram_quantile(0.50, sum(irate(istio_request_duration_milliseconds_bucket{reporter=~"$reporter",destination_mesh_id="$mesh", connection_security_policy="mutual_tls", destination_service=~"$service", source_workload=~"$srcwl", source_workload_namespace=~"$srcns"}[1m])) by (source_workload, source_workload_namespace, le)) / 1000) or histogram_quantile(0.50, sum(irate(istio_request_duration_seconds_bucket{reporter=~"$reporter",destination_mesh_id="$mesh", connection_security_policy="mutual_tls", destination_service=~"$service", source_workload=~"$srcwl", source_workload_namespace=~"$srcns"}[1m])) by (source_workload, source_workload_namespace, le)) |
|                | åŸºäºæºçš„ä¼ å…¥è¯·æ±‚å¤§å°                    | å±•ç¤ºæŒ‰æºå·¥ä½œè´Ÿè½½ä¼ å…¥çš„è¯·æ±‚å¤§å°ï¼Œåˆ†åˆ«è®¡ç®—äº†P50ã€P90ã€P95 å’Œ P99ç­‰åˆ†ä½æ•°ä¸åŒçš„è¯·æ±‚å¤§å°ã€‚ |                                                              |
|                | åŸºäºæºçš„å“åº”å¤§å°                        | å±•ç¤ºæŒ‰æºå·¥ä½œè´Ÿè½½ï¼ˆsource workloadï¼‰å±•ç¤ºäº†åœ¨ P50ã€P90ã€P95ã€P99 (ğŸ”mTLS): è¡¨ç¤ºåœ¨å¯ç”¨äº†ç›¸äº’TLSï¼ˆmTLSï¼‰çš„æƒ…å†µä¸‹çš„å“åº”å¤§å°çš„ç™¾åˆ†ä½æ•° |                                                              |
|                | æ¥æ”¶æ¥è‡ªä¼ å…¥ TCP è¿æ¥çš„å­—èŠ‚æ•°           | å±•ç¤ºå½“å‰æœåŠ¡é€šè¿‡ TCP è¿æ¥æ”¶åˆ°çš„å­—èŠ‚æ•°ï¼Œå¹¶ä¸”å±•ç¤ºåœ¨ mutual TLS è¿æ¥ï¼ˆæ ‡è®°ä¸º ğŸ”mTLSï¼‰å’Œé mutual TLS è¿æ¥ä¸‹ä» TCP è¿æ¥æ”¶åˆ°çš„å­—èŠ‚æ•°çš„æƒ…å†µ |                                                              |
|                | å‘é€åˆ°ä¼ å…¥ TCP è¿æ¥çš„å­—èŠ‚æ•°             | å±•ç¤ºå½“å‰æœåŠ¡é€šè¿‡ TCP è¿æ¥å‘é€çš„å­—èŠ‚æ•°ï¼Œå¹¶ä¸”å±•ç¤ºåœ¨ mutual TLS è¿æ¥ï¼ˆæ ‡è®°ä¸º ğŸ”mTLSï¼‰å’Œé mutual TLS è¿æ¥ä¸‹ä» TCP è¿æ¥æ”¶åˆ°çš„å­—èŠ‚æ•°çš„æƒ…å†µ |                                                              |
| æœåŠ¡å·¥ä½œè´Ÿè½½   | åŸºäºç›®æ ‡è´Ÿè½½å’Œå“åº”ç çš„ä¼ å…¥è¯·æ±‚          | å±•ç¤ºæŒ‰ç›®çš„å·¥ä½œè´Ÿè½½å’Œå“åº”ä»£ç åˆ†ç±»çš„ä¼ å…¥è¯·æ±‚ï¼Œèƒ½å¤Ÿå¯è§†åŒ–åœ°å±•ç¤ºå„ç§å·¥ä½œè´Ÿè½½ä¹‹é—´çš„äº¤äº’æƒ…å†µï¼Œåˆ†åˆ«å¯¹å…·æœ‰å’Œä¸å…·æœ‰äº’ç›¸è®¤è¯TLSçš„è¿æ¥è¿›è¡Œè®¡ç®—ï¼Œä»¥æä¾›å¯¹è¿æ¥å®‰å…¨æ€§çš„æ´å¯Ÿã€‚å¯ä»¥æ¸…æ™°åœ°äº†è§£è¯·æ±‚å¦‚ä½•åœ¨ä¸åŒçš„æºå’Œç›®çš„åœ°ä¹‹é—´åˆ†å¸ƒã€‚ |                                                              |
|                | åŸºäºç›®æ ‡è´Ÿè½½çš„ä¼ å…¥æˆåŠŸç‡ï¼ˆé 5xx å“åº”ï¼‰ | å±•ç¤ºæŒ‰ç›®çš„å·¥ä½œè´Ÿè½½å’Œå‘½åç©ºé—´åˆ†ç±»çš„ä¼ å…¥æˆåŠŸç‡ï¼Œå…¶ä¸­æˆåŠŸç‡æ˜¯é5xxå“åº”çš„ç™¾åˆ†æ¯”ï¼Œåˆ†åˆ«å¯¹å…·æœ‰å’Œä¸å…·æœ‰äº’ç›¸è®¤è¯TLSçš„è¿æ¥è¿›è¡Œè®¡ç®—ï¼Œä»¥æä¾›å¯¹è¿æ¥æˆåŠŸç‡çš„è§†å›¾ã€‚ |                                                              |
|                | åŸºäºæœåŠ¡è´Ÿè½½çš„ä¼ å…¥è¯·æ±‚æ—¶å»¶              | å±•ç¤ºæŒ‰ç›®çš„å·¥ä½œè´Ÿè½½å’Œå‘½åç©ºé—´çš„è¯·æ±‚è€—æ—¶ï¼Œåˆ†åˆ«è®¡ç®—äº†P50ã€P90ã€P95 å’Œ P99ç­‰åˆ†ä½æ•°ä¸åŒçš„è¯·æ±‚æŒç»­æ—¶é—´ã€‚æ³¨æ„ï¼Œå°†åˆ†ä½å€¼é™¤ä»¥ 1000 è½¬ä¸ºä¸ºç§’ä½œä¸ºå•ä½ã€‚ |                                                              |
|                | åŸºäºæœåŠ¡è´Ÿè½½çš„ä¼ å…¥è¯·æ±‚å¤§å°              | å±•ç¤ºæŒ‰ç›®çš„å·¥ä½œè´Ÿè½½ä¼ å…¥çš„è¯·æ±‚å¤§å°ï¼Œåˆ†åˆ«è®¡ç®—äº†P50ã€P90ã€P95 å’Œ P99ç­‰åˆ†ä½æ•°ä¸åŒçš„è¯·æ±‚å¤§å°ã€‚ |                                                              |
|                | åŸºäºæœåŠ¡è´Ÿè½½çš„å“åº”å¤§å°                  | å±•ç¤ºæŒ‰ç›®çš„å·¥ä½œè´Ÿè½½ï¼ˆsource workloadï¼‰å±•ç¤ºäº†åœ¨ P50ã€P90ã€P95ã€P99 (ğŸ”mTLS): è¡¨ç¤ºåœ¨å¯ç”¨äº†ç›¸äº’TLSï¼ˆmTLSï¼‰çš„æƒ…å†µä¸‹çš„å“åº”å¤§å°çš„ç™¾åˆ†ä½æ•° |                                                              |
|                | æ¥æ”¶æ¥è‡ªä¼ å…¥ TCP è¿æ¥çš„å­—èŠ‚æ•°           | å±•ç¤ºå½“å‰æœåŠ¡é€šè¿‡ TCP è¿æ¥æ”¶åˆ°çš„å­—èŠ‚æ•°ï¼Œå¹¶ä¸”å±•ç¤ºåœ¨ mutual TLS è¿æ¥ï¼ˆæ ‡è®°ä¸º ğŸ”mTLSï¼‰å’Œé mutual TLS è¿æ¥ä¸‹ä» TCP è¿æ¥æ”¶åˆ°çš„å­—èŠ‚æ•°çš„æƒ…å†µ |                                                              |
|                | å‘é€åˆ°ä¼ å…¥ TCP è¿æ¥çš„å­—èŠ‚æ•°             | å±•ç¤ºå½“å‰æœåŠ¡é€šè¿‡ TCP è¿æ¥å‘é€çš„å­—èŠ‚æ•°ï¼Œå¹¶ä¸”å±•ç¤ºåœ¨ mutual TLS è¿æ¥ï¼ˆæ ‡è®°ä¸º ğŸ”mTLSï¼‰å’Œé mutual TLS è¿æ¥ä¸‹ä» TCP è¿æ¥æ”¶åˆ°çš„å­—èŠ‚æ•°çš„æƒ…å†µ |                                                              |

## å·¥ä½œè´Ÿè½½ç›‘æ§

![å·¥ä½œè´Ÿè½½ç›‘æ§](../images/monitoring-indicators4.png)

| åˆ†ç±»           | å‚æ•°               | å‚æ•°ä»‹ç»                                                  | è®¡ç®—æ–¹å¼                                                  |
| --------------------- | ------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| å¸¸è§„         | ä¼ å…¥è¯·æ±‚é‡                          | å±•ç¤ºå½“å‰å·¥ä½œè´Ÿè½½çš„ä¼ å…¥è¯·æ±‚é‡ï¼Œå•ä½ä¸º Opsï¼Œå¦‚æœæ¥æ”¶åˆ°çš„æ•°æ®ä¸ºç©ºï¼ˆnullï¼‰ï¼Œåˆ™ä¼šæ˜¾ç¤º "N/A" | è®¡ç®—è¿‡å» 5 åˆ†é’Ÿå†…çš„ä¼ å…¥è¯·æ±‚æ€»æ•°ï¼Œå…¶ä¸­åŒ…æ‹¬ç‰¹å®šçš„ç›®çš„åœ°å·¥ä½œè´Ÿè½½ã€å‘½åç©ºé—´å’Œé›†ç¾¤ã€‚ |
|              | ä¼ å…¥æˆåŠŸç‡ï¼ˆé 5xx å“åº”ï¼‰           | å±•ç¤ºå½“å‰å·¥ä½œè´Ÿè½½çš„æ¯ 5 åˆ†é’Ÿçš„æˆåŠŸè¯·æ±‚ç‡ï¼ˆä¸å« 5xx çš„è¯·æ±‚ï¼‰ï¼Œå¹¶ä¸”æä¾›äº†ä¸€ç§å¯è§†åŒ–æ–¹å¼æ¥å¿«é€Ÿè¯†åˆ«æ½œåœ¨çš„é—®é¢˜æˆ–è¶‹åŠ¿ã€‚å¦‚æœæˆåŠŸç‡ä½äº 95%ï¼Œå°†æ˜¾ç¤ºä¸ºçº¢è‰²ï¼Œå¦‚æœä½äº 99%ï¼Œåˆ™æ˜¾ç¤ºä¸ºæ©™è‰² | ä½¿ç”¨äº†ä¸¤ä¸ªåˆ†æ¯å’Œåˆ†å­çš„æŸ¥è¯¢æ¥è®¡ç®—é 5xx å“åº”çš„ç™¾åˆ†æ¯”ã€‚åˆ†å­è®¡ç®—ä¸ç‰¹å®šæœåŠ¡ç›¸å…³çš„é 5xx å“åº”ï¼Œåˆ†æ¯è®¡ç®—ä¸è¯¥æœåŠ¡ç›¸å…³çš„æ‰€æœ‰è¯·æ±‚ |
|              | è¯·æ±‚æ—¶å»¶                            | å±•ç¤ºå½“å‰å·¥ä½œè´Ÿè½½çš„è¯·æ±‚çš„æ—¶å»¶ï¼Œåˆ†åˆ«æ˜¾ç¤º P50ã€P90 å’Œ P99 çš„è¯·æ±‚æŒç»­æ—¶é—´ï¼Œå¯ä»¥ç”¨äºè§‚å¯Ÿç³»ç»Ÿçš„æ€§èƒ½ï¼Œå¹¶å¿«é€Ÿè¯†åˆ«æ½œåœ¨çš„ç“¶é¢ˆæˆ–å»¶è¿Ÿé—®é¢˜ã€‚ | (histogram_quantile(0.50, sum(irate(istio_request_duration_milliseconds_bucket{reporter=~"$reporter",destination_mesh_id="$mesh",destination_workload=~"$workload", destination_cluster=~"$dstcluster", destination_workload_namespace=~"$namespace"}[1m])) by (le)) / 1000) or histogram_quantile(0.50, sum(irate(istio_request_duration_seconds_bucket{reporter=~"$reporter",destination_mesh_id="$mesh",destination_workload=~"$workload", destination_cluster=~"$dstcluster", destination_workload_namespace=~"$namespace"}[1m])) by (le)) |
|              | TCP æœåŠ¡ç«¯æµé‡                      | å±•ç¤ºå½“å‰å·¥ä½œè´Ÿè½½çš„TCP æœåŠ¡å™¨æµé‡ï¼Œæ³¨é‡ç»Ÿè®¡ä½œä¸ºç›®æ ‡å·¥ä½œè´Ÿè½½ã€å‘½åç©ºé—´å’Œé›†ç¾¤ï¼Œå³ä½œä¸º TCP æœåŠ¡å™¨ï¼Œæœ‰åŠ©äºäº†è§£ç½‘ç»œè´Ÿè½½å’Œå¯èƒ½çš„ç“¶é¢ˆï¼›å¹¶ä»¥æ¯ç§’å­—èŠ‚ï¼ˆBpsï¼‰ä¸ºå•ä½æ˜¾ç¤º TCP å‘é€å’Œæ¥æ”¶çš„å­—èŠ‚æ€»æ•°ã€‚ | destination_workload_namespace=~"$namespace", destination_workload=~"$workload", destination_cluster=~"$dstcluster" |
|              | TCP å®¢æˆ·ç«¯æµé‡                      | å±•ç¤ºå½“å‰å·¥ä½œè´Ÿè½½çš„ TCP å®¢æˆ·ç«¯çš„æµé‡ï¼Œæ³¨é‡ç»Ÿè®¡ä½œä¸ºæºå·¥ä½œè´Ÿè½½ã€å‘½åç©ºé—´å’Œé›†ç¾¤ï¼Œå³ä½œä¸º TCPæœåŠ¡å™¨ï¼Œæœ‰åŠ©äºäº†è§£ç½‘ç»œè´Ÿè½½å’Œå¯èƒ½çš„ç“¶é¢ˆï¼›å¹¶ä»¥æ¯ç§’å­—èŠ‚ï¼ˆBpsï¼‰ä¸ºå•ä½æ˜¾ç¤º TCP å‘é€å’Œæ¥æ”¶çš„å­—èŠ‚æ€»æ•°ã€‚ | source_workload_namespace=~"$namespace", source_workload=~"$workload" |
| å…¥ç«™å·¥ä½œè´Ÿè½½ | åŸºäºæºå’Œå“åº”ç çš„ä¼ å…¥è¯·æ±‚            | å±•ç¤ºå½“å‰å·¥ä½œè´Ÿè½½ä¸­ï¼Œæ ¹æ®æºå·¥ä½œè´Ÿè½½å’Œå“åº”ä»£ç åˆ†ç±»çš„ä¼ å…¥è¯·æ±‚ï¼Œè®¡ç®—ä½¿ç”¨å’Œä¸ä½¿ç”¨åŒå‘ TLS è¿æ¥çš„ä¼ å…¥è¯·æ±‚é€Ÿç‡ï¼Œå¹¶æŒ‰æºå·¥ä½œè´Ÿè½½ã€æºå‘½åç©ºé—´å’Œå“åº”ä»£ç åˆ†ç±» | ç¤ºä¾‹ï¼š round(sum(irate(istio_requests_total{connection_security_policy!="mutual_tls", destination_workload_namespace=~"$namespace", destination_workload=~"$workload", destination_cluster=~"$dstcluster", reporter=~"$reporter",destination_mesh_id="$mesh", source_workload=~"$srcwl", source_workload_namespace=~"$srcns"}[5m])) by (source_workload, source_workload_namespace, response_code), 0.001) |
|              | åŸºäºæºçš„ä¼ å…¥æˆåŠŸç‡ï¼ˆé 5xx å“åº”ï¼‰   | å±•ç¤ºä¼ å…¥æˆåŠŸè¯·æ±‚çš„æ¯”ç‡ï¼ˆé 5xx å“åº”ï¼‰ï¼Œåˆ†åˆ«æŒ‰ä½¿ç”¨å’Œä¸ä½¿ç”¨åŒå‘ TLS çš„è¿æ¥è¿›è¡Œåˆ†ç±»ï¼Œå¹¶è¿›ä¸€æ­¥æŒ‰æºå·¥ä½œè´Ÿè½½å’Œæºå‘½åç©ºé—´åˆ†ç»„ã€‚ | sum(irate(istio_requests_total{reporter=~"$reporter",destination_mesh_id="$mesh", connection_security_policy="mutual_tls", destination_workload_namespace=~"$namespace", destination_workload=~"$workload", destination_cluster=~"$dstcluster",response_code!~"5.*", source_workload=~"$srcwl", source_workload_namespace=~"$srcns"}[5m])) by (source_workload, source_workload_namespace) / sum(irate(istio_requests_total{reporter=~"$reporter",destination_mesh_id="$mesh", connection_security_policy="mutual_tls", destination_workload_namespace=~"$namespace", destination_workload=~"$workload", destination_cluster=~"$dstcluster", source_workload=~"$srcwl", source_workload_namespace=~"$srcns"}[5m])) by (source_workload, source_workload_namespace) |
|              | åŸºäºæºçš„ä¼ å…¥è¯·æ±‚æ—¶å»¶                | å±•ç¤ºä½¿ç”¨åŒå‘TLSï¼ˆæ ‡å¿—ä¸ºğŸ”mTLSï¼‰å’Œæœªä½¿ç”¨åŒå‘TLSçš„æºå·¥ä½œè´Ÿè½½çš„è¯·æ±‚æŒç»­æ—¶é—´ã€‚é€šè¿‡å„ç§ç™¾åˆ†ä½æ•° P50ã€P90å’Œ P99ï¼Œå¯ä»¥æ›´å¥½åœ°ç†è§£ä¸åŒå·¥ä½œè´Ÿè½½ä¸‹çš„æ€§èƒ½è¡¨ç° |                                                              |
|              | åŸºäºæºçš„ä¼ å…¥è¯·æ±‚å¤§å°                | å±•ç¤ºæ¥è‡ªä¸åŒæ¥æºçš„è¯·æ±‚å¤§å°çš„å›¾è¡¨ï¼Œå¢åŠ äº†ç”¨äºè®¡ç®—ä¸åŒåˆ†ä½æ•°P50ã€P90ã€P95å’ŒP99çš„è¯·æ±‚å¤§å°ã€‚ |                                                              |
|              | åŸºäºæºçš„å“åº”å¤§å°                    | å±•ç¤ºå“åº”å¤§å°çš„çº¿å‹å›¾è¡¨ï¼Œå¯ç”¨äºç›‘æ§æ¥è‡ªä¸åŒæ¥æºçš„å“åº”å¤§å°ï¼Œä½¿ç”¨äº†histogram_quantileå‡½æ•°è®¡ç®—ä¸åŒåˆ†ä½æ•°çš„å“åº”å­—èŠ‚å¤§å°ï¼ˆä¾‹å¦‚P50ã€P90ã€P95å’ŒP99ï¼‰ã€‚ |                                                              |
|              | æ¥æ”¶æ¥è‡ªä¼ å…¥ TCP è¿æ¥çš„å­—èŠ‚æ•°       | å±•ç¤ºä¸ä¼ å…¥TCPè¿æ¥ç›¸å…³çš„å­—èŠ‚æ¥æ”¶æƒ…å†µï¼Œåˆ†åˆ«è¡¨ç¤ºä¸mTLSå’ŒémTLSçš„è¿æ¥æœ‰å…³çš„æ•°æ®ã€‚ |                                                              |
|              | å‘é€åˆ°ä¼ å…¥ TCP è¿æ¥çš„å­—èŠ‚æ•°         | å±•ç¤ºå¯¹å‘é€åˆ°ä¼ å…¥TCPè¿æ¥çš„å­—èŠ‚çš„å¯è§†åŒ–è¡¨ç¤ºã€‚é€šè¿‡ä¸ä¹‹å‰çš„å›¾è¡¨ç»“åˆï¼Œå¯ä»¥æä¾›å®Œæ•´çš„å¯¹TCPè¿æ¥çš„ç›‘æ§è§†å›¾ï¼ŒåŒæ—¶æ¯”è¾ƒå¯ç”¨å’Œæœªå¯ç”¨mTLSçš„è¿æ¥ |                                                              |
| å‡ºç«™å·¥ä½œè´Ÿè½½ | åŸºäºç›®æ ‡å’Œå“åº”ç çš„ä¼ å‡ºè¯·æ±‚          | å±•ç¤ºæŒ‰ç›®çš„åœ°å’Œå“åº”ä»£ç çš„ä¼ å‡ºè¯·æ±‚ï¼ŒåŸºäº istio_requests_total æŒ‡æ ‡ï¼Œï¼Œåˆ†åˆ«è¡¨ç¤ºä¸mTLSå’ŒémTLSçš„è¯·æ±‚é‡æ•°æ®ã€‚ | round(sum(irate(istio_requests_total{destination_principal=~"spiffe.*", source_workload_namespace=~"$namespace", source_workload=~"$workload", reporter="source", destination_mesh_id="$mesh", destination_service=~"$dstsvc"}[5m])) by (destination_service, response_code), 0.001) |
|              | åŸºäºç›®æ ‡çš„ä¼ å‡ºæˆåŠŸç‡ï¼ˆé 5xx å“åº”ï¼‰ | å±•ç¤ºä¼ å‡ºæˆåŠŸè¯·æ±‚çš„æ¯”ç‡ï¼ˆé 5xx å“åº”ï¼‰ï¼Œåˆ†åˆ«æŒ‰ä½¿ç”¨å’Œä¸ä½¿ç”¨åŒå‘ TLS çš„è¿æ¥è¿›è¡Œåˆ†ç±»ï¼Œå¹¶è¿›ä¸€æ­¥æŒ‰æºå·¥ä½œè´Ÿè½½å’Œæºå‘½åç©ºé—´åˆ†ç»„ã€‚ |                                                              |
|              | åŸºäºç›®æ ‡çš„ä¼ å‡ºè¯·æ±‚æ—¶å»¶              | å±•ç¤ºå¯¹åº”è¯·æ±‚ç›®æ ‡ä¼ å‡ºçš„è¯·æ±‚æ—¶é•¿çš„ç™¾åˆ†ä½ï¼Œæ”¯æŒ50ã€P90ã€P95å’ŒP99ã€‚åŒæ—¶æ”¯æŒmTLSå’ŒémTLSçš„çš„å®‰å…¨ç­–ç•¥ï¼Œå•ä½ï¼šç§’/æ¯«ç§’ã€‚ |                                                              |
|              | åŸºäºç›®æ ‡çš„ä¼ å‡ºè¯·æ±‚å¤§å°              | å±•ç¤ºåœ¨ä½¿ç”¨mTLSå’Œä¸ä½¿ç”¨æ—¶ä¼ å‡ºçš„è¯·æ±‚å¤§å°ï¼Œæ”¯æŒæ”¯æŒ50ã€P90ã€P95å’ŒP99ã€‚è¡¨è¾¾å¼ä¸­ä½¿ç”¨äº†ä¸ Istioã€å·¥ä½œè´Ÿè½½ã€å‘½åç©ºé—´å’Œç›®æ ‡æœåŠ¡ç›¸å…³çš„æ ‡ç­¾è¿›è¡Œè¿‡æ»¤ã€‚ |                                                              |
|              | åŸºäºç›®æ ‡çš„å“åº”å¤§å°                  | å±•ç¤ºä¼ å‡ºä¸åŒç›®çš„åœ°çš„å“åº”å¤§å°ï¼Œåˆ†åˆ«è®¡ç®—äº† P50ã€P90ã€P95 å’Œ P99 çš„å€¼ï¼Œæœ‰çš„ä¸ mutual_tls çš„è¿æ¥å®‰å…¨ç­–ç•¥ç›¸å…³è”ã€‚ |                                                              |
|              | ä¼ å‡º TCP è¿æ¥å‘é€çš„å­—èŠ‚æ•°           | å±•ç¤ºé€šè¿‡TCPè¿æ¥å‘å‡ºçš„å­—èŠ‚ã€‚é€šè¿‡å¯¹æ¯”mTLSï¼ˆåŒå‘TLSï¼‰å’ŒémTLSè¿æ¥ï¼Œæ·±å…¥äº†è§£ä¸åŒå®‰å…¨ç­–ç•¥ä¸‹çš„å­—èŠ‚å‘é€æƒ…å†µã€‚ |                                                              |
|              | æ¥æ”¶æ¥è‡ªä¼ å‡º TCP è¿æ¥çš„å­—èŠ‚æ•°       | å±•ç¤ºé€šè¿‡ç›®çš„æœåŠ¡å‘å‡ºçš„å¤–éƒ¨TCPè¿æ¥æ¥æ”¶çš„å­—èŠ‚é‡ï¼Œ åˆ†åˆ«ç»Ÿè®¡é€šè¿‡ mutual TLS å’Œä¸é€šè¿‡ mutual TLS è¿›è¡Œä¿æŠ¤çš„è¿æ¥çš„å­—èŠ‚æ€»é‡ | ç¤ºä¾‹ï¼š round(sum(irate(istio_tcp_sent_bytes_total{reporter="source", destination_mesh_id="$mesh", connection_security_policy!="mutual_tls", source_workload_namespace=~"$namespace", source_workload=~"$workload", destination_service=~"$dstsvc"}[1m])) by (destination_service), 0.001) |