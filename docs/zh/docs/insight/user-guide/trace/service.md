# 服务监控

在 __可观测性 Insight__ 中服务是指使用 Opentelemtry SDK 接入链路数据，服务监控能够辅助运维过程中观察应用程序的性能和状态。

如何使用 OpenTelemetry 请参考[使用 OTel 赋予应用可观测性](../../quickstart/otel/otel.md)。

## 名词解释

- **服务** ：服务表示为传入请求提供相同行为的一组工作负载。您可以在使用 OpenTelemetry SDK 时定义服务名称或使用 Istio 中定义的名称。
- **操作** ：操作是指一个服务处理的特定请求或操作，每个 Span 都有一个操作名称。
- **出口流量** ：出口流量是指当前服务发起请求的所有流量。
- **入口流量** ：入口流量是指上游服务对当前服务发起请求的所有流量。

## 操作步骤

服务列表页面展示了集群中所有已接入链路数据的服务的吞吐率、错误率、请求延时等关键指标。
您可以根据集群、命名空间对服务进行过滤，也可以按照吞吐率、错误率、请求延时对该列表进行排序。列表中的指标数据默认时间为 1 小时，您可以自定义时间范围。

请按照以下步骤查看服务监控指标：

1. 进入 __可观测性__ 产品模块。

2. 在左边导航栏选择 __链路追踪__ -> __服务__ 。

    ![服务监控](https://docs.daocloud.io/daocloud-docs-images/docs/zh/docs/insight/images/service00.png){ width="1000"}

    !!! attention

        1. 若列表中服务所在的命名空间为 __unknown__ 时，则表示该服务未规范接入，建议重新接入。
        2. 若接入的服务存在同名且均未正确填写环境变量中的 __命名空间__ 时，列表及服务详情页中展示的监控数据为多个服务的汇总数据。

3. 点击服务名 (以 insight-server 为例)，点击进入服务详情页，查看服务的详细指标和该服务的操作指标。

    1. 在服务拓扑模块中，您可以查看当前所选服务的上下各一层的服务拓扑，鼠标悬浮在节点上时可以查看节点的信息。
    2. 在流量指标模块，您可查看到该服务默认一小时内全部请求（包含入口流量和出口流量）的监控指标。
    3. 支持通过右上角的时间选择器快速选择时间范围，或自定义时间范围。
    4. 在 __关联容器__ 模块点击容器组名称，可跳转至容器组详情页。

    ![服务监控](../../images/service.png){ width="1000"}

4. 点击 Tab 切换到 __操作指标__ ，可查询多选服务相同操作的聚合起来的流量指标。

    1. 支持对操作指标中的吞吐率、错误率、请求延时等指标进行排序。
    2. 点击单个操作后的图标，可跳转至 __调用链__ 快速查询相关链路。

    ![服务监控](../../images/service-1.png){ width="1000"}

### 服务指标说明

| 参数     | 说明                                     |
| -------- | ---------------------------------------- |
| 吞吐率   | 单位时间内处理请求的数量。               |
| 错误率   | 查询时间范围内错误请求与请求总数的比值。 |
| P50 请求延时 | 在所有的请求中，有 50% 的请求响应时间小于或等于该值。 |
| P95 请求延时 | 在所有的请求中，有 95% 的请求响应时间小于或等于该值。 |
| P99 请求延时 | 在所有的请求中，有 95% 的请求响应时间小于或等于该值。 |
